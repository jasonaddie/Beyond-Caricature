<% pub = Publication %>
<%
  column_size = 'is-6-mobile is-4-tablet is-3-desktop is-3'
  card_partial = 'shared/card_meta_down'
  image_size = '400x204#'
  hacked_class = 'hacked-mobile'
  if params[:view].present? && params[:view].downcase == 'list'
    column_size = 'is-12'
    card_partial = 'shared/card_meta_right'
    image_size = '400x400#'
    hacked_class = ''
  end
%>

<div class="columns is-centered">
  <div class="column is-10">

    <h1 class="title is-3"><%= title t('labels.publications') %></h1>

    <div class="filters illustrations">
      <div class="columns">
        <div class="column is-3">
          <div class="filter-label">
            <label for="filter_search"><%= t('labels.filter.search') %></label>
          </div>
          <div class="filter-search">
            <div class="control has-icons-right">
              <%= text_field :filter, :search, value: params[:search], 'data-key': 'search' %>
              <span class="icon is-right">
                <i class="search"></i>
              </span>
            </div>
          </div>
        </div>
        <div class="column is-3">
          <div class="filter-label">
            <div class="control has-icons-right">
              <label for="filter_type"><%= t('labels.filter.source_type') %></label>
              <span class="icon is-right">
                <i class="down-arrow"></i>
              </span>
            </div>
          </div>
          <div class="filter-select">
            <%= select(:filter, :type, options_for_select(@filter_source_types, params[:type]), {prompt: ''}, {style: 'width: 100%', 'data-key': 'type'}) %>
          </div>
        </div>
        <div class="column is-3">
          <div class="filter-label">
            <div class="control has-icons-right">
              <label for="filter_language"><%= t('labels.filter.language') %></label>
              <span class="icon is-right">
                <i class="down-arrow"></i>
              </span>
            </div>
          </div>
          <div class="filter-select">
            <%= collection_select(:filter, :language, @filter_languages, :id, :language, {selected: params[:language], prompt: ''}, {style: 'width: 100%', 'data-key': 'language'}) %>
          </div>
        </div>
      </div>
    </div>

    <%= render partial: 'shared/list_switcher', locals: {records: @publications} %>

    <div class="columns is-multiline <%= hacked_class %>">
      <% @publications.each do |publication| %>
        <div class="column <%= column_size %>">
          <%= render partial: card_partial, locals: {
                title: publication.title,
                summary: card_partial == 'shared/card_meta_right' ? publication.about : nil,
                link_path: source_path(publication),
                cover_image_path: publication.cover_image.thumb(image_size).url,
                type: pub.human_enum_name(:publication_type, publication.publication_type),
                language: publication.language,
                date_label: I18n.t("labels.publication_dates.#{publication.publication_type}"),
                date: publication.date
            } %>
        </div>
      <% end %>
    </div>

    <div class="columns is-centered">
      <duv class="column is-8">
        <%= paginate @publications, window: 2 %>
      </duv>
    </div>

  </div>
</div>